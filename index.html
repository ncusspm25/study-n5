    <script>
        // ==========================================
        // 資料庫結構 (與之前相同，這裡省略重複的資料定義，請保留原本的 db 陣列)
        // 為了節省版面，請使用上一版完整的 db 陣列
        // ==========================================
        
        // --- 請確保這裡有原本的 const db = [...] 資料 ---
        // (如果你是直接複製，這裡我預設保留上面那份完整的資料，
        //  若需要我再貼一次完整 500 字的 db，請告訴我)
        
        // 這裡僅列出邏輯修正所需的變數與函式
        
        const codeContainer = document.getElementById('code-container');
        const progressIndicator = document.getElementById('progress-indicator');
        const bossScreen = document.getElementById('boss-screen');
        let currentIdx = 0;
        let correctCount = 0;
        let isBossMode = false;
        
        // 狀態控制： 'input' (輸入中) 或 'result' (已批改，等待下一題)
        let gameState = 'input'; 

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let queue = shuffle([...db]);

        function renderQuestion() {
            // 重置狀態為輸入模式
            gameState = 'input'; 

            if (queue.length === 0) {
                queue = shuffle([...db]);
            }
            
            const item = queue.pop();
            currentIdx++;
            const lineNum = 10 + Math.floor(Math.random() * 50);
            let html = '';

            if (item.mode === 'g') {
                html = `
<div class="line"><span class="ln">${lineNum}</span><span class="code"><span class="doc">/**</span></span></div>
<div class="line"><span class="ln">${lineNum+1}</span><span class="code"><span class="doc"> * Grammar: ${item.desc}</span></span></div>
<div class="line"><span class="ln">${lineNum+2}</span><span class="code"><span class="doc"> * Reading: ${item.r}</span></span></div>
<div class="line"><span class="ln">${lineNum+3}</span><span class="code"><span class="doc"> */</span></span></div>
<div class="line"><span class="ln">${lineNum+4}</span><span class="code"><span class="k">const</span> <span class="v">sentence</span> = <span class="s">"${item.pre} <input id="ans-input" autocomplete="off" style="width:50px; text-align:center;"> ${item.post}"</span>;</span></div>
<div class="line"><span class="ln">${lineNum+5}</span><span class="code"><span class="v">console</span>.<span class="f">log</span>(<span class="v">sentence</span>);</span></div>
<div class="line"><span class="ln">${lineNum+6}</span><span class="code" id="feedback"></span></div>`;
            } else {
                let typeStr = item.t === 'v' ? 'Verb' : (item.t === 'adj' ? 'Adjective' : (item.t === 'adv' ? 'Adverb' : 'Noun'));
                html = `
<div class="line"><span class="ln">${lineNum}</span><span class="code"><span class="doc">/**</span></span></div>
<div class="line"><span class="ln">${lineNum+1}</span><span class="code"><span class="doc"> * Reading: ${item.r} </span></span></div>
<div class="line"><span class="ln">${lineNum+2}</span><span class="code"><span class="doc"> * Hint:    ${item.h} </span></span></div>
<div class="line"><span class="ln">${lineNum+3}</span><span class="code"><span class="doc"> */</span></span></div>
<div class="line"><span class="ln">${lineNum+4}</span><span class="code"><span class="k">export</span> <span class="k">const</span> <span class="v">${item.k}</span>: <span class="t">${typeStr}</span> = <span class="s">"<input id="ans-input" autocomplete="off" placeholder="...">"</span>;</span></div>
<div class="line"><span class="ln">${lineNum+5}</span><span class="code" id="feedback"></span></div>`;
            }

            codeContainer.innerHTML = html;
            
            const input = document.getElementById('ans-input');
            input.focus();
            input.dataset.answers = JSON.stringify(item.a);
            
            // 監聽 Enter 鍵
            input.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') {
                    if (gameState === 'input') {
                        // 第一次按：檢查答案
                        checkAnswer(input);
                    } else {
                        // 第二次按：下一題
                        renderQuestion();
                    }
                }
            });
            
            progressIndicator.innerText = `Ln ${lineNum+4}, Col 12`;
        }

        function checkAnswer(input) {
            const userVal = input.value.trim().toLowerCase();
            const answers = JSON.parse(input.dataset.answers);
            const feedback = document.getElementById('feedback');
            
            const correct = answers.some(a => a.toLowerCase() === userVal);

            // 切換狀態，下次按 Enter 就會跳下一題
            gameState = 'result'; 

            if (correct) {
                input.style.color = '#b5cea8'; // Greenish
                // 顯示按 Enter 繼續的提示
                feedback.innerHTML = `<span class="c">// OK. Saved. <span style="opacity:0.5; font-size:0.8em;">(Press Enter)</span></span>`;
                correctCount++;
                // 這裡拿掉 setTimeout，改由使用者手動按 Enter 決定速度
                // 如果你想保留「答對自動跳轉，但按 Enter 可以加速」，可以保留下面這行：
                // setTimeout(() => { if(gameState==='result') renderQuestion() }, 800); 
            } else {
                input.style.color = '#f44747'; // Red
                input.style.borderBottom = '1px solid #f44747';
                // 顯示正確答案
                feedback.innerHTML = `<span class="c" style="color:#f44747">// Error: Expected "${answers[0]}" <span style="color:#858585;">(Press Enter)</span></span>`;
            }
        }

        document.addEventListener('keydown', (e) => {
            // Boss Key
            if (e.key === 'Escape') {
                isBossMode = !isBossMode;
                if(isBossMode) {
                    bossScreen.style.display = 'block';
                    document.title = 'Command Prompt';
                } else {
                    bossScreen.style.display = 'none';
                    document.title = 'vocabulary.ts - Project N5';
                    const input = document.getElementById('ans-input');
                    if(input) input.focus();
                }
            }
            // 全域 Enter 支援 (防止焦點跑掉時按 Enter 沒反應)
            if (e.key === 'Enter' && gameState === 'result') {
                renderQuestion();
            }
        });

        // 初始化
        renderQuestion();
    </script>
